<?php session_start();?>
<?=$msg?>


<?php 
$g_id = $_REQUEST['g_id'];

?>




<!--  Übersicht oben -->

<legend><h1>Gruppen&uumlbersicht</h1></legend>

<div class=>
	<table>
			<tr><td>Gruppenname: <?=$gruppe[0]->getGruppenname()?></td><td rowspan=2 width="300" align="right"><div class="big-circular-image"><img src =<?=$gruppe[0]->getGruppenbildpfad()?> height = "100" width = "100" alt = "Kein Bild vorhanden"></div></td></tr>
			<tr><td>Beschreibung: <?=$gruppe[0]->getGruppenbeschreibung()?></td></tr>
	</table></div>

<br><br><br>

<table>
	
	
<tr>	
<!-- Meine Zahlungen in dieser Gruppe -->	

	
	<td><form action="statistiken?gruppe=<?=$gruppe[0]->getG_id()?>" method="post">
	
		<input class="button" type="submit" style="width:330px" name='sofortauslesen' value="Meine Zahlungen in dieser Gruppe">
		
	</form></td>	
	
<!-- Gruppenverlauf -->	

	<td><form action="gruppenverlauf?g_id=<?=$gruppe[0]->getG_id()?>" method="post">
	
			<input type="hidden" name='g_id' value='<?=$gruppe[0]->getG_id()?>'>
			<input class="button" style="width:330px" type="submit" value="Gruppenverlauf">
			
	</form></td>
</tr>

<tr>	
<!--  CSV Download -->

	<td><form action="groupcsv" method="post">
			
			<input type="hidden" name='g_id' value='<?=$g_id?>'>
			<input class="button" style="width:330px" type="submit" value="Gruppenzahlungen als CSV-Download">
		
	</form></td>
	
	
<!--  Neue Mitglieder hinzufügen -->	


	<?php if ($aktgruppenmitglied->getGruppenadmin()=="1") {?>
	<td><form action="usersuchen" method="post">

		<!--  Kann wegen neuer intelligenter Suche weg
		<th>Neues Mitglied hinzuf&uuml;gen</th>
		<tr><td>Suche:</td><td><input name="suche" type="text" maxlength="255" size="20" required></td> 
		-->
		 <input type="hidden" name="g_id" readonly="readonly" value="<?=$gruppe[0]->getG_id()?>">
		<input class="button" style="width:330px" type="submit" value="Neues Mitglied hinzuf&uuml;gen">
		
	</form></td>
	<?php }?>
</tr>

</table>
<br>


<!--  Anzeige der Gruppenmitglieder mit fremden Profilaufruf und Adminrechten -->


<table width="70%" border="8" cellspacing="10" cellpadding="20">
	<tr><th>Gruppenmitglieder:</th></tr>
		<tr>
			<th></th>
			<th>Vorname</th>
			<th>Nachname</th>
			<th>Benutzername</th>
			<th>Gruppenadmin</th>
			<th></th>
		</tr>
	
	
	<?php 
	foreach ($mitgliederListe as $zaehler => $gruppenmitglied) {
	?>
		
		<tr>
			<?php if ($gruppenmitglied->getUser()->getU_id()==$aktgruppenmitglied->getUser()->getU_id()) { ?>
				<td><div class="small-circular-image"><img src =<?=$gruppenmitglied->getUser()->getTeilnehmerbildpfad()?> height = "100" width = "100" alt = "Kein Bild vorhanden"></div></td>
			<?php } else { ?>
				<td><div class="small-circular-image"><a href="fremdesprofil?u_id=<?=$gruppenmitglied->getUser()->getU_id()?>"><img src =<?=$gruppenmitglied->getUser()->getTeilnehmerbildpfad()?> height = "100" width = "100" alt = "Kein Bild vorhanden"></a></div></td>
			<?php }?>
			<td><?=$gruppenmitglied->getUser()->getVorname()?></td>
			<td><?=$gruppenmitglied->getUser()->getNachname()?></td>
			<td><a href="fremdesprofil?u_id=<?=$gruppenmitglied->getUser()->getU_id()?>"><?=$gruppenmitglied->getUser()->getUsername()?></a></td>
			<?php
			if ($gruppenmitglied->getGruppenadmin() == "1") {
				?>
					<td>ja</td>
			<?php } else {
				?>
					<td>nein</td> 
			<?php 
			}	
			if ($aktgruppenmitglied->getGruppenadmin()=="1" && $aktgruppenmitglied != $gruppenmitglied && $gruppenmitglied->getUser()->getDeaktiviert()=="0") {
			?>
			<form method="post"> 
			<input type="hidden" name="gruppenadminwert" value="<?=$gruppenmitglied->getGruppenadmin()?>">
			<input type="hidden" name="g_id" value="<?=$gruppenmitglied->getGruppe()->getG_id()?>">
			<input type="hidden" name="u_id" value="<?=$gruppenmitglied->getUser()->getU_id()?>">
			<td><input class="button" type="submit" name="gruppenadmin" value="Gruppenadminrechte &auml;ndern"></td>
			</form>
			
			<form action="userausgruppeentfernen" method="post"> 
			<input type="hidden" name="g_id" value="<?=$gruppenmitglied->getGruppe()->getG_id()?>">
			<input type="hidden" name="u_id" value="<?=$gruppenmitglied->getUser()->getU_id()?>">
			<td><input class="button" type="submit" name="userentfernen" value="Aus Gruppe entfernen"></td>
			</form>
			
			<?php }
			if ($gruppenmitglied->getUser()->getDeaktiviert()=="1") {?>
			<td>User ist deaktiviert!</td>
			<?php }?>
		</tr>

	<?php 
	}
	?>
	</table>
	
<br><br><br>

<!--  Messageboard -->


<?php if ($aktnachricht != NULL) {?>

<a class="button" onclick="text1.style.display='block';an.style.display='none';zu.style.display='block'" id="an" style="display: none; width:250px" href="#neu">Message Board anzeigen</a>
<a class="button" onclick="text1.style.display='none';an.style.display='block';zu.style.display='none'" id="zu" style="display: block; width:270px" href="#neu">Message Board ausblenden</a>
<a name="neu"></a><DIV id="text1" style="display: block">

<table class="datentabelle" border="0" width="100%">
  <tr class="datentabelle">
    <th class="datentabelle" >Absender</th>
    <th class="datentabelle">Datum</th>
    <th class="datentabelle"> Nachricht</th>
    <th class="datentabelle"width="5%"></th>
  </tr class="datentabelle">
  
  <?php foreach ($aktnachricht as $zaehler => $nachricht) {?>
  
  <tr class="datentabelle">
    <td class="datentabelle"><?=$nachricht->getUser()->getUsername()?></td>
    <td class="datentabelle"><?=$nachricht->getdatum()?> 
    <td class="datentabelle"><?=$nachricht->getText()?></td>
    <td class="datentabelle"><?php 
    		if($_SESSION['user']->getU_id() == $nachricht->getUser()->getU_id())
    			{?>
    				<a href='nachrichtbearbeiten?n_id=<?=$nachricht->getN_id()?>&g_id=<?=$_REQUEST['g_id']?>'><img src="img/edit.jpg" title="Nachricht bearbeiten"/></a>
		<?php 	;}?>
	</td>
  </tr class="datentabelle">
  <?php }?>
</table>

<br>

<?php }?>

<!--  Abschicken neuer Nachrichten -->

<form  action="groupshow?g_id=<?=$gruppe[0]->getG_id()?>" method='post'>
    <label>Nachricht:</label><br>
   	 <textarea name="text" required rows="5" cols="40"></textarea>
 <br>
    <input class="button" type="submit"  name = "abschicken" value="Abschicken">
</form>
</div>	
<br><br>
	
<!-- Gruppe verlassen -->	
	
	<form action="gruppeverlassen" method="post">
	
		<input type="hidden" name="g_id" readonly="readonly" value="<?=$gruppe[0]->getG_id()?>">
	 	<input type="hidden" name="u_id" readonly="readonly" value="<?=$user_id?>">
		<input class="button" type="submit" value="Gruppe verlassen">
		
	</form>
										